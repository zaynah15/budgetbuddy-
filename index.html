<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#FFB6C1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Spendora">
<title>Spendora - Your Wallet's Glow-Up</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  
  :root {
    --bg-primary: #FFF8F2;
    --bg-secondary: #ffffff;
    --bg-card: #ffffff;
    --bg-input: #fdf9ff;
    --bg-gradient-start: #ffe2ee;
    --bg-gradient-end: #f0e4ff;
    --text-primary: #7c5a8a;
    --text-secondary: #b09cc0;
    --text-tertiary: #c8aed8;
    --border-color: #f0e2ff;
    --shadow: rgba(180,140,200,0.12);
    --shadow-heavy: rgba(180,140,200,0.25);
    --ring-track: #f0e4fa;
    --star-pink: #FFB6C1;
    --star-black: #2d1a35;
  }
  
  body.dark-mode {
    --bg-primary: #1a0a20;
    --bg-secondary: #2d1a35;
    --bg-card: #2d1a35;
    --bg-input: #3a2445;
    --bg-gradient-start: #2d1535;
    --bg-gradient-end: #1a0a20;
    --text-primary: #e8d0f0;
    --text-secondary: #c8a8d8;
    --text-tertiary: #a888c0;
    --border-color: #4a3455;
    --shadow: rgba(0,0,0,0.3);
    --shadow-heavy: rgba(0,0,0,0.5);
    --ring-track: #3a2a45;
  }
  
  body { 
    background: var(--bg-primary);
    font-family: 'Nunito', sans-serif; 
    -webkit-font-smoothing: antialiased;
    overscroll-behavior: none;
    -webkit-user-select: none;
    user-select: none;
    transition: background 0.3s ease;
  }
  
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  input, textarea { -webkit-user-select: text; user-select: text; }
  
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--text-tertiary); border-radius: 99px; }

  @keyframes pulse { 0%,100%{opacity:0.6;transform:scale(1);}50%{opacity:1;transform:scale(1.08);} }
  @keyframes wobble { from{transform:rotate(-8deg) scale(1.1);}to{transform:rotate(8deg) scale(1.1);} }
  @keyframes glutton { from{transform:rotate(-14deg) scale(0.88);}to{transform:rotate(14deg) scale(1.12);} }
  @keyframes slideDown { from{opacity:0;transform:translateX(-50%) translateY(-24px);}to{opacity:1;transform:translateX(-50%) translateY(0);} }
  @keyframes slideUp { from{opacity:0;transform:translateX(-50%) translateY(24px);}to{opacity:1;transform:translateX(-50%) translateY(0);} }
  @keyframes fadeIn { from{opacity:0;}to{opacity:1;} }
  @keyframes sheetUp { from{opacity:0;transform:translateY(100%);}to{opacity:1;transform:translateY(0);} }
  @keyframes popIn { from{opacity:0;transform:scale(0.6);}to{opacity:1;transform:scale(1);} }
  @keyframes fall { to{transform:translateY(110vh) rotate(720deg);} }
  @keyframes spin { from{transform:rotate(0deg);}to{transform:rotate(360deg);} }
  @keyframes slideRow { from{opacity:0;transform:translateX(-10px);}to{opacity:1;transform:translateX(0);} }
  @keyframes blobA { from{transform:translateY(0) scale(1);}to{transform:translateY(-28px) scale(1.04);} }
  @keyframes blobB { from{transform:translateY(0) scale(1);}to{transform:translateY(24px) scale(0.97);} }
  @keyframes bounce { 0%,100%{transform:scale(1) translateY(0);}50%{transform:scale(1.1) translateY(-5px);} }
  @keyframes bellRing { 0%,100%{transform:rotate(0deg);}10%,30%{transform:rotate(-10deg);}20%,40%{transform:rotate(10deg);} }
  @keyframes float { from{transform:translateY(0px);}to{transform:translateY(-15px);} }
  @keyframes shake { 0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);} }
  @keyframes starGlow { 0%,100%{transform:scale(1) rotate(0deg);filter:drop-shadow(0 0 5px var(--star-pink));}50%{transform:scale(1.15) rotate(180deg);filter:drop-shadow(0 0 15px var(--star-pink));} }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FIREBASE CONFIG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const firebaseConfig = {
  apiKey: "AIzaSyAyIwTNZB0mYWYPViDiHhYQsrc-DTyWmrk",
  authDomain: "budgetbuddy-4168c.firebaseapp.com",
  projectId: "budgetbuddy-4168c",
  storageBucket: "budgetbuddy-4168c.firebasestorage.app",
  messagingSenderId: "943210794388",
  appId: "1:943210794388:web:88940dc98f36240ec7d381",
  measurementId: "G-6PPJB2CLZJ"
};

let auth, db, isFirebaseConfigured = false;
try {
  if (firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();
    isFirebaseConfigured = true;
  }
} catch (error) {
  console.error("Firebase init error:", error);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SMS PARSER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function parseSMS(text) {
  if (!text) return null;
  const patterns = [
    /Rs\.?\s*(\d+(?:,\d+)*(?:\.\d{2})?)/i,
    /INR\.?\s*(\d+(?:,\d+)*(?:\.\d{2})?)/i,
    /‚Çπ\.?\s*(\d+(?:,\d+)*(?:\.\d{2})?)/i,
  ];
  for (const pattern of patterns) {
    const match = text.match(pattern);
    if (match) {
      const amount = parseFloat(match[1].replace(/,/g, ''));
      if (amount > 0) return Math.round(amount);
    }
  }
  return null;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFIG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CATS = {
  food:      { label:"Food",      emoji:"üçú", color:"#FFB6C1", dark:"#d4507a", lightBg:"#fff0f4", darkBg:"#3d2535" },
  clothing:  { label:"Clothing",  emoji:"üëó", color:"#B5D8FF", dark:"#3a85d4", lightBg:"#f0f6ff", darkBg:"#252d45" },
  travel:    { label:"Travel",    emoji:"‚úàÔ∏è",  color:"#C1F0DC", dark:"#2aaa78", lightBg:"#f0fcf7", darkBg:"#253d35" },
  education: { label:"Education", emoji:"üìö", color:"#E6E6FA", dark:"#6060c0", lightBg:"#f5f5ff", darkBg:"#2d2d45" },
  hobbies:   { label:"Hobbies",   emoji:"üéÆ", color:"#FFD6BA", dark:"#d4703a", lightBg:"#fff7f0", darkBg:"#3d3025" },
};

const NUDGES = [
  "üåø Eat intentionally.",
  "üòã Hungry or just bored?",
  "üí≠ Need or craving?",
  "üçé Your wallet says: cook at home!",
  "üßò Pause before you pay.",
  "üí° Tomorrow-you will be grateful.",
];

const DEF_BUDGETS = { food:2000, clothing:1500, travel:1000, education:1500, hobbies:800 };
const NOTIF_SK = "spendora_notifs";
const THEME_SK = "spendora_theme";
const SPENT_TODAY_SK = "spendora_spent_today";
const TIMEZONE_SK = "spendora_timezone";

const NOTIF_TIMES = [
  { hour: 12, minute: 0 },
  { hour: 16, minute: 0 },
  { hour: 21, minute: 0 },
  { hour: 23, minute: 0 },
];

function loadNotifSettings() {
  try { 
    const r = localStorage.getItem(NOTIF_SK); 
    return r ? JSON.parse(r) : { enabled: false, permission: 'default' }; 
  } catch { 
    return { enabled: false, permission: 'default' }; 
  }
}

function saveNotifSettings(d) { localStorage.setItem(NOTIF_SK, JSON.stringify(d)); }

function loadTheme() {
  try { return localStorage.getItem(THEME_SK) || 'light'; }
  catch { return 'light'; }
}

function saveTheme(theme) {
  localStorage.setItem(THEME_SK, theme);
  document.body.classList.toggle('dark-mode', theme === 'dark');
}

function loadTimezone() {
  try {
    const saved = localStorage.getItem(TIMEZONE_SK);
    return saved ? JSON.parse(saved) : null;
  } catch {
    return null;
  }
}

function saveTimezone(data) {
  localStorage.setItem(TIMEZONE_SK, JSON.stringify(data));
}

function markSpentToday() {
  const today = new Date().toDateString();
  localStorage.setItem(SPENT_TODAY_SK, today);
}

function hasSpentToday() {
  const today = new Date().toDateString();
  const lastSpent = localStorage.getItem(SPENT_TODAY_SK);
  return lastSpent === today;
}

function getInitState() {
  const spent = {}, budgets = {};
  Object.keys(CATS).forEach(k => {
    spent[k] = 0;
    budgets[k] = DEF_BUDGETS[k];
  });
  
  const now = new Date();
  const monthKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
  const monthName = now.toLocaleString("default", {month:"long", year:"numeric"});
  
  return { 
    budgets,
    spent,
    transactions: [],
    monthKey,
    monthName,
    salary: 0,
    yearlyLog: {}, // { "2025-02": { star: "pink", spent: {...}, transactions: [...], salary: 10000 } }
    currentStar: null, // Will be calculated
  };
}

function calculateStar(spent, budgets) {
  const totalSpent = Object.values(spent).reduce((a, b) => a + b, 0);
  const totalBudget = Object.values(budgets).reduce((a, b) => a + b, 0);
  return totalSpent <= totalBudget ? "pink" : "black";
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NOTIFICATION MANAGER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function scheduleNotifications() {
  if (!('Notification' in window)) return;
  
  const now = new Date();
  let nextNotif = null, minDiff = Infinity;
  
  NOTIF_TIMES.forEach(t => {
    const targetTime = new Date();
    targetTime.setHours(t.hour, t.minute, 0, 0);
    if (targetTime <= now) targetTime.setDate(targetTime.getDate() + 1);
    const diff = targetTime - now;
    if (diff < minDiff) {
      minDiff = diff;
      nextNotif = targetTime;
    }
  });
  
  if (nextNotif && minDiff > 0) {
    setTimeout(() => {
      if (hasSpentToday()) {
        showSpendingReminder();
      }
      scheduleNotifications();
    }, minDiff);
  }
}

function showSpendingReminder() {
  if (!('Notification' in window) || Notification.permission !== 'granted') return;
  
  const notif = new Notification("Hey! üí∏", {
    body: "Did you log all your spending today?",
    icon: "logo.png",
    tag: 'spending-reminder',
    requireInteraction: true,
    vibrate: [200, 100, 200],
  });
  
  notif.onclick = () => {
    window.focus();
    window.dispatchEvent(new CustomEvent('open-quick-log'));
    notif.close();
  };
}

// Check if month has ended and auto-close
function checkMonthEnd(state, setState, showToast) {
  const now = new Date();
  const currentMonthKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
  
  if (state.monthKey !== currentMonthKey) {
    // Month has changed! Close previous month
    const star = calculateStar(state.spent, state.budgets);
    const totalSpent = Object.values(state.spent).reduce((a, b) => a + b, 0);
    const totalBudget = Object.values(state.budgets).reduce((a, b) => a + b, 0);
    const saved = state.salary - totalSpent;
    
    const newYearlyLog = {
      ...state.yearlyLog,
      [state.monthKey]: {
        star,
        spent: {...state.spent},
        budgets: {...state.budgets},
        transactions: [...state.transactions],
        salary: state.salary,
        totalSpent,
        totalBudget,
        saved,
        monthName: state.monthName,
      }
    };
    
    // Reset for new month
    const newSpent = {};
    Object.keys(CATS).forEach(k => { newSpent[k] = 0; });
    
    setState({
      ...state,
      monthKey: currentMonthKey,
      monthName: now.toLocaleString("default", {month:"long", year:"numeric"}),
      spent: newSpent,
      transactions: [],
      salary: 0,
      yearlyLog: newYearlyLog,
      currentStar: null,
    });
    
    if (star === "pink") {
      showToast(`üéâ ${state.monthName} complete! You earned a Pink Star ‚≠ê for staying on budget!`, "success", 5000);
    } else {
      showToast(`üìä ${state.monthName} complete. Black Star ‚≠ê - Let's do better this month!`, "info", 5000);
    }
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   COMPONENTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function SignInScreen({ isDark }) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const handleGoogleSignIn = async () => {
    if (!isFirebaseConfigured) {
      setError("Firebase not configured. Check setup guide.");
      return;
    }
    
    setLoading(true);
    setError(null);
    
    try {
      const provider = new firebase.auth.GoogleAuthProvider();
      await auth.signInWithPopup(provider);
    } catch (err) {
      if (err.code === 'auth/popup-closed-by-user') setError("Sign-in cancelled");
      else if (err.code === 'auth/network-request-failed') setError("Network error");
      else if (err.code === 'auth/unauthorized-domain') setError("Domain not authorized in Firebase");
      else setError("Sign-in failed: " + err.message);
      setLoading(false);
    }
  };

  return (
    <div style={{
      minHeight:"100dvh",
      background: `linear-gradient(160deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%)`,
      display:"flex", alignItems:"center", justifyContent:"center", padding:"20px",
    }}>
      <div style={{
        background: "var(--bg-card)", borderRadius:32, padding:"48px 36px",
        maxWidth:420, width:"100%", boxShadow: `0 32px 80px var(--shadow-heavy)`,
        textAlign:"center", animation:"popIn 0.5s cubic-bezier(.34,1.56,.64,1)",
      }}>
        <img src="logo.png" alt="Spendora" style={{
          width:120, height:120, marginBottom:24,
          animation:"float 3s ease-in-out infinite alternate"
        }} />
        
        <h1 style={{
          fontFamily:"'Nunito',sans-serif", fontSize:32, fontWeight:900,
          background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",
          WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent",
          marginBottom:8,
        }}>Spendora</h1>
        
        <p style={{
          fontFamily:"'Nunito',sans-serif", fontSize:16, fontWeight:800,
          color: "var(--text-secondary)", marginBottom:32, lineHeight:1.5,
        }}>Your Wallet's Glow-Up.</p>

        {!isFirebaseConfigured && (
          <div style={{
            background:"#fff3cd", border:"2px solid #ffc107", borderRadius:16,
            padding:"12px", marginBottom:20, fontFamily:"'Nunito',sans-serif",
            fontSize:13, fontWeight:700, color:"#856404", textAlign:"left",
          }}>
            ‚ö†Ô∏è <strong>Setup Required:</strong> Configure Firebase first.
          </div>
        )}

        {error && (
          <div style={{
            background:"#fff0f0", border:"2px solid #ff6b6b", borderRadius:16,
            padding:"12px", marginBottom:20, fontFamily:"'Nunito',sans-serif",
            fontSize:13, fontWeight:700, color:"#ff6b6b",
          }}>{error}</div>
        )}

        <button onClick={handleGoogleSignIn} disabled={loading || !isFirebaseConfigured} style={{
          width:"100%", background: (loading || !isFirebaseConfigured) ? "#e8ddf0" : "white",
          border: `2px solid var(--border-color)`, borderRadius:16, padding:"16px 24px",
          fontFamily:"'Nunito',sans-serif", fontSize:16, fontWeight:900,
          color: (loading || !isFirebaseConfigured) ? "#c8b8d8" : "var(--text-primary)",
          cursor: (loading || !isFirebaseConfigured) ? "not-allowed" : "pointer",
          display:"flex", alignItems:"center", justifyContent:"center", gap:12,
          boxShadow: `0 4px 16px var(--shadow)`, transition:"all 0.2s ease",
        }}>
          {loading ? (
            <>
              <div style={{
                width:20, height:20, border:"3px solid #e8ddf0",
                borderTopColor:"#9b6dbd", borderRadius:"50%",
                animation:"spin 0.8s linear infinite",
              }}/>
              Signing in...
            </>
          ) : (
            <>
              <svg width="20" height="20" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              Continue with Google
            </>
          )}
        </button>

        <div style={{
          marginTop:24, fontFamily:"'Nunito',sans-serif", fontSize:12,
          fontWeight:700, color: "var(--text-tertiary)", lineHeight:1.6,
        }}>
          Sign in to sync across devices<br/>and share with friends ü§ù
        </div>
      </div>
    </div>
  );
}

// NEW: Timezone Setup Screen
function TimezoneSetup({ onComplete, isDark }) {
  const [country, setCountry] = useState("");
  const [timezone, setTimezone] = useState("");
  
  const handleSubmit = () => {
    if (!country || !timezone) return;
    saveTimezone({ country, timezone });
    onComplete();
  };
  
  return (
    <div style={{
      minHeight:"100dvh", background: "var(--bg-primary)",
      display:"flex", alignItems:"center", justifyContent:"center",
      padding:"20px",
    }}>
      <div style={{
        background: "var(--bg-card)", borderRadius:32, padding:"40px 32px",
        maxWidth:420, width:"100%", boxShadow: `0 32px 80px var(--shadow-heavy)`,
        animation:"popIn 0.5s cubic-bezier(.34,1.56,.64,1)",
      }}>
        <div style={{textAlign:"center", marginBottom:28}}>
          <div style={{fontSize:48, marginBottom:12}}>üåç</div>
          <h2 style={{
            fontFamily:"'Nunito',sans-serif", fontSize:22, fontWeight:900,
            color: "var(--text-primary)", marginBottom:8,
          }}>Setup Your Location</h2>
          <p style={{
            fontFamily:"'Nunito',sans-serif", fontSize:14, fontWeight:700,
            color: "var(--text-secondary)",
          }}>For automatic month-end detection</p>
        </div>
        
        <div style={{marginBottom:20}}>
          <label style={{
            display:"block", fontFamily:"'Nunito',sans-serif",
            fontSize:12, fontWeight:800, color: "var(--text-secondary)",
            marginBottom:8, textTransform:"uppercase", letterSpacing:0.5,
          }}>Country</label>
          <input type="text" placeholder="e.g., India" value={country}
            onChange={e => setCountry(e.target.value)}
            style={{
              width:"100%", border: `2px solid var(--border-color)`,
              borderRadius:14, padding:"12px 16px",
              fontFamily:"'Nunito',sans-serif", fontSize:15, fontWeight:700,
              color: "var(--text-primary)", background: "var(--bg-input)",
              outline:"none",
            }}
          />
        </div>
        
        <div style={{marginBottom:28}}>
          <label style={{
            display:"block", fontFamily:"'Nunito',sans-serif",
            fontSize:12, fontWeight:800, color: "var(--text-secondary)",
            marginBottom:8, textTransform:"uppercase", letterSpacing:0.5,
          }}>Timezone</label>
          <select value={timezone} onChange={e => setTimezone(e.target.value)}
            style={{
              width:"100%", border: `2px solid var(--border-color)`,
              borderRadius:14, padding:"12px 16px",
              fontFamily:"'Nunito',sans-serif", fontSize:15, fontWeight:700,
              color: "var(--text-primary)", background: "var(--bg-input)",
              outline:"none",
            }}>
            <option value="">Select timezone...</option>
            <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
            <option value="Asia/Dubai">Asia/Dubai (GST)</option>
            <option value="America/New_York">America/New_York (EST)</option>
            <option value="Europe/London">Europe/London (GMT)</option>
            <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
            <option value="Australia/Sydney">Australia/Sydney (AEDT)</option>
          </select>
        </div>
        
        <button onClick={handleSubmit} disabled={!country || !timezone}
          style={{
            width:"100%",
            background: (country && timezone)
              ? "linear-gradient(135deg,#FFB6C1,#c8a0e0)"
              : "#e8ddf0",
            border:"none", borderRadius:999, padding:"14px",
            fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:16,
            color: (country && timezone) ? "white" : "#c8b8d8",
            cursor: (country && timezone) ? "pointer" : "not-allowed",
            boxShadow: (country && timezone)
              ? "0 6px 20px rgba(255,182,193,0.5)"
              : "none",
          }}>Continue ‚Üí</button>
      </div>
    </div>
  );
}

// NEW: Salary Setup Screen
function SalarySetup({ currentBudgets, onComplete, isDark }) {
  const [salary, setSalary] = useState("");
  const [budgets, setBudgets] = useState(currentBudgets);
  const [step, setStep] = useState(1);
  
  const totalBudget = Object.values(budgets).reduce((a, b) => a + b, 0);
  const projectedSavings = Number(salary) - totalBudget;
  
  const handleNext = () => {
    if (step === 1 && salary && Number(salary) > 0) {
      setStep(2);
    } else if (step === 2) {
      onComplete(Number(salary), budgets);
    }
  };
  
  return (
    <div style={{
      minHeight:"100dvh", background: "var(--bg-primary)",
      padding:"20px", overflowY:"auto",
    }}>
      <div style={{maxWidth:460, margin:"0 auto", paddingTop:40}}>
        <div style={{textAlign:"center", marginBottom:32}}>
          <img src="logo.png" alt="Spendora" style={{width:80, height:80, marginBottom:16}} />
          <h2 style={{
            fontFamily:"'Nunito',sans-serif", fontSize:24, fontWeight:900,
            background:"linear-gradient(135deg,#c06080,#9b6dbd)",
            WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent",
            marginBottom:8,
          }}>Monthly Budget Setup</h2>
          <p style={{
            fontFamily:"'Nunito',sans-serif", fontSize:14, fontWeight:700,
            color: "var(--text-secondary)",
          }}>Step {step} of 2</p>
        </div>
        
        {step === 1 ? (
          <div style={{
            background: "var(--bg-card)", borderRadius:24, padding:"28px 24px",
            boxShadow: `0 8px 32px var(--shadow)`,
          }}>
            <div style={{marginBottom:24}}>
              <div style={{fontSize:40, textAlign:"center", marginBottom:12}}>üí∞</div>
              <h3 style={{
                fontFamily:"'Nunito',sans-serif", fontSize:18, fontWeight:900,
                color: "var(--text-primary)", textAlign:"center", marginBottom:20,
              }}>What is your income this month?</h3>
              
              <div style={{
                display:"flex", alignItems:"center",
                border: `2px solid var(--border-color)`, borderRadius:16,
                background: "var(--bg-input)", overflow:"hidden",
              }}>
                <span style={{
                  padding:"0 16px", fontFamily:"'Nunito',sans-serif",
                  fontWeight:900, fontSize:26, color:"#c8a0e0",
                }}>‚Çπ</span>
                <input type="number" placeholder="0" value={salary}
                  onChange={e => setSalary(e.target.value)}
                  onKeyDown={e => e.key === "Enter" && handleNext()}
                  autoFocus
                  style={{
                    flex:1, border:"none", outline:"none",
                    fontFamily:"'Nunito',sans-serif", fontWeight:900,
                    fontSize:32, color: "var(--text-primary)",
                    background:"transparent", padding:"16px 12px",
                  }}
                />
              </div>
            </div>
            
            <button onClick={handleNext} disabled={!salary || Number(salary) <= 0}
              style={{
                width:"100%",
                background: (salary && Number(salary) > 0)
                  ? "linear-gradient(135deg,#FFB6C1,#c8a0e0)"
                  : "#e8ddf0",
                border:"none", borderRadius:999, padding:"14px",
                fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:16,
                color: (salary && Number(salary) > 0) ? "white" : "#c8b8d8",
                cursor: (salary && Number(salary) > 0) ? "pointer" : "not-allowed",
                boxShadow: (salary && Number(salary) > 0)
                  ? "0 6px 20px rgba(255,182,193,0.5)"
                  : "none",
              }}>Next ‚Üí</button>
          </div>
        ) : (
          <div>
            <div style={{
              background: "var(--bg-card)", borderRadius:24, padding:"24px",
              boxShadow: `0 8px 32px var(--shadow)`, marginBottom:16,
            }}>
              <h3 style={{
                fontFamily:"'Nunito',sans-serif", fontSize:18, fontWeight:900,
                color: "var(--text-primary)", marginBottom:20, textAlign:"center",
              }}>Set Budget Per Category</h3>
              
              {Object.entries(CATS).map(([k, cat]) => (
                <div key={k} style={{
                  marginBottom:14, padding:"14px", border: `2px solid ${cat.color}`,
                  borderRadius:16, background: isDark ? cat.darkBg : cat.lightBg,
                }}>
                  <div style={{
                    display:"flex", alignItems:"center", gap:12, marginBottom:8,
                  }}>
                    <span style={{fontSize:24}}>{cat.emoji}</span>
                    <div style={{flex:1}}>
                      <label style={{
                        fontFamily:"'Nunito',sans-serif", fontSize:14,
                        fontWeight:900, color: "var(--text-primary)",
                      }}>{cat.label}</label>
                    </div>
                  </div>
                  <div style={{display:"flex", alignItems:"center", gap:6}}>
                    <span style={{
                      fontFamily:"'Nunito',sans-serif", fontSize:18,
                      fontWeight:900, color:cat.dark,
                    }}>‚Çπ</span>
                    <input type="number" value={budgets[k]}
                      onChange={e => setBudgets({...budgets, [k]: Number(e.target.value)})}
                      style={{
                        flex:1, border: `1.5px solid ${cat.color}`,
                        borderRadius:10, padding:"10px 12px",
                        fontFamily:"'Nunito',sans-serif", fontSize:16,
                        fontWeight:800, color: "var(--text-primary)",
                        background: "var(--bg-input)", outline:"none",
                      }}
                    />
                  </div>
                </div>
              ))}
            </div>
            
            <div style={{
              background: projectedSavings >= 0
                ? "linear-gradient(135deg,#6fd4a8,#40c8a0)"
                : "linear-gradient(135deg,#ff6b6b,#ff8e53)",
              borderRadius:20, padding:"18px 20px", marginBottom:16,
              boxShadow: `0 6px 24px ${projectedSavings >= 0 ? "rgba(111,212,168,0.4)" : "rgba(255,107,107,0.4)"}`,
            }}>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:13, fontWeight:800,
                color:"white", marginBottom:4, opacity:0.9,
              }}>
                {projectedSavings >= 0 ? "You will save:" : "Budget exceeds income:"}
              </div>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:32, fontWeight:900,
                color:"white",
              }}>‚Çπ{Math.abs(projectedSavings).toLocaleString()}</div>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:12, fontWeight:700,
                color:"white", marginTop:6, opacity:0.85,
              }}>
                {projectedSavings >= 0 
                  ? "if you stick to these budgets üí™"
                  : "reduce your budgets to save money ‚ö†Ô∏è"}
              </div>
            </div>
            
            <button onClick={handleNext}
              style={{
                width:"100%",
                background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",
                border:"none", borderRadius:999, padding:"14px",
                fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:16,
                color:"white", cursor:"pointer",
                boxShadow:"0 6px 20px rgba(255,182,193,0.5)",
              }}>Start Tracking ‚Üí</button>
          </div>
        )}
      </div>
    </div>
  );
}

function Toast({message, type, visible}) {
  if (!visible) return null;
  const bg = type==="error" ? "linear-gradient(135deg,#ff6b6b,#ff8e6b)"
    : type==="warn" ? "linear-gradient(135deg,#ffb347,#ffd060)"
    : type==="success" ? "linear-gradient(135deg,#6fd4a8,#40c8a0)"
    : "linear-gradient(135deg,#b5d8ff,#80b8ff)";
  
  return (
    <div style={{
      position:"fixed", top:20, left:"50%", transform:"translateX(-50%)",
      background:bg, color:"white", padding:"12px 24px", borderRadius:999,
      fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:14,
      boxShadow:"0 8px 28px rgba(0,0,0,0.15)", zIndex:9998,
      animation:"slideDown 0.35s cubic-bezier(.34,1.56,.64,1)",
      whiteSpace:"nowrap", maxWidth:"88vw",
    }}>{message}</div>
  );
}

function Confetti({active}) {
  if (!active) return null;
  const colors = ["#FFB6C1","#B5D8FF","#C1F0DC","#E6E6FA","#FFD6BA","#ffd700","#ff9de2","#a0f0c0"];
  return (
    <div style={{position:"fixed", inset:0, pointerEvents:"none", zIndex:9999, overflow:"hidden"}}>
      {Array.from({length:45}, (_, i) => (
        <div key={i} style={{
          position:"absolute", top:-16, left:`${Math.random() * 100}%`,
          width: 8 + Math.random() * 6, height: 8 + Math.random() * 6,
          borderRadius: Math.random() > 0.5 ? "50%" : "2px",
          background: colors[i % colors.length],
          animation: `fall ${1.4 + Math.random() * 2}s ${Math.random() * 0.7}s ease-in forwards`,
          transform: `rotate(${Math.random() * 360}deg)`,
        }}/>
      ))}
    </div>
  );
}

function GluttonModal({category, overspentAmount, totalBudget, totalSpent, onClose, isDark}) {
  if (!category) return null;
  const cat = CATS[category];
  const totalLeft = totalBudget - totalSpent;
  const projectedSavings = Math.max(0, totalLeft);
  
  return (
    <div onClick={onClose} style={{
      position:"fixed", inset:0,
      background: isDark ? "rgba(0,0,0,0.7)" : "rgba(100,50,140,0.45)",
      backdropFilter:"blur(8px)", display:"flex", alignItems:"center",
      justifyContent:"center", zIndex:9997, animation:"fadeIn 0.2s ease",
    }}>
      <div onClick={e => e.stopPropagation()} style={{
        background: "var(--bg-card)", borderRadius:32, padding:"36px 28px",
        textAlign:"center", maxWidth:340, width:"90%",
        boxShadow: `0 32px 80px var(--shadow-heavy)`,
        animation:"popIn 0.4s cubic-bezier(.34,1.56,.64,1)",
      }}>
        <div style={{
          fontSize:70, animation:"glutton 0.7s ease-in-out infinite alternate",
          lineHeight:1.1,
        }}>üò°</div>
        
        <div style={{
          fontFamily:"'Nunito',sans-serif", fontSize:20, fontWeight:900,
          color:"#ff6b6b", marginTop:12,
        }}>Budget Busted!</div>
        
        <div style={{
          background:"#fff0f0", border:"2px solid #ff6b6b",
          borderRadius:16, padding:"12px", marginTop:12,
          fontFamily:"'Nunito',sans-serif", fontSize:16, fontWeight:900,
          color:"#ff6b6b",
        }}>+‚Çπ{overspentAmount} overspent</div>
        
        <div style={{
          fontFamily:"'Nunito',sans-serif", fontSize:14,
          color: "var(--text-secondary)", marginTop:12, lineHeight:1.7,
        }}>
          You crossed your <strong style={{color:cat.dark}}>{cat.label}</strong> budget.<br/>
          <strong style={{color:"#ff6b6b"}}>
            This way you won't be able to save ‚Çπ{projectedSavings} by the end of this month.
          </strong><br/>
          Come on, you're better than this!!
        </div>
        
        <button onClick={onClose} style={{
          marginTop:20, background:"linear-gradient(135deg,#ff6b6b,#ff8e53)",
          color:"white", border:"none", borderRadius:999, padding:"12px 28px",
          fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:15,
          cursor:"pointer", boxShadow:"0 4px 16px rgba(255,107,107,0.5)",
        }}>I'll do better üí™</button>
      </div>
    </div>
  );
}

function Nudge({visible, message, onClose}) {
  if (!visible) return null;
  return (
    <div style={{
      position:"fixed", bottom:24, left:"50%", transform:"translateX(-50%)",
      background:"linear-gradient(135deg,#fff8f2,#ffe8f5)",
      border:"2px solid #FFB6C1", borderRadius:20, padding:"13px 20px",
      fontFamily:"'Nunito',sans-serif", fontSize:14, fontWeight:700,
      color:"#c06080", boxShadow:"0 8px 30px rgba(255,182,193,0.3)",
      zIndex:9996, animation:"slideUp 0.4s cubic-bezier(.34,1.56,.64,1)",
      display:"flex", alignItems:"center", gap:10, maxWidth:"88vw",
    }}>
      <span style={{fontSize:20}}>üåø</span>
      {message}
      <span onClick={onClose} style={{
        marginLeft:8, cursor:"pointer", fontSize:16,
        color:"#e8a0b0", fontWeight:900,
      }}>‚úï</span>
    </div>
  );
}

function NotificationButton({ enabled, onClick }) {
  return (
    <button onClick={onClick} style={{
      position:"fixed", top:80, right:20, zIndex:10001,
      width:48, height:48, borderRadius:"50%",
      background: enabled 
        ? "linear-gradient(135deg,#6fd4a8,#40c8a0)"
        : "linear-gradient(135deg,#ff6b6b,#ff8e53)",
      border:"none", cursor:"pointer",
      display:"flex", alignItems:"center", justifyContent:"center",
      fontSize:24, boxShadow: `0 4px 16px var(--shadow)`,
      transition:"all 0.3s ease",
      animation: enabled ? "" : "shake 0.5s ease-in-out infinite",
    }} title={enabled ? 'Notifications ON' : 'Notifications OFF - Tap to enable'}>
      {enabled ? 'üîî' : 'üîï'}
    </button>
  );
}

function QuickLogModal({ onLog, onSkip, isDark }) {
  const [amount, setAmount] = useState("");
  const [category, setCategory] = useState(null);
  const inputRef = useRef(null);
  
  useEffect(() => { inputRef.current?.focus(); }, []);
  
  const handleSubmit = () => {
    if (!amount || !category) return;
    onLog(Number(amount), category);
    setAmount("");
    setCategory(null);
  };
  
  return (
    <div style={{
      position:"fixed", inset:0,
      background: isDark ? "rgba(0,0,0,0.7)" : "rgba(70,30,110,0.45)",
      backdropFilter:"blur(10px)", display:"flex", alignItems:"center",
      justifyContent:"center", zIndex:9999, animation:"fadeIn 0.2s ease",
    }}>
      <div style={{
        background: "var(--bg-card)", borderRadius:28, padding:"28px 24px",
        width:"90%", maxWidth:380, boxShadow: `0 32px 80px var(--shadow-heavy)`,
        animation:"popIn 0.4s cubic-bezier(.34,1.56,.64,1)",
      }}>
        <div style={{textAlign:"center", marginBottom:20}}>
          <div style={{fontSize:44, marginBottom:8}}>üí∏</div>
          <div style={{
            fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:18,
            color: "var(--text-primary)",
          }}>Did you spend today?</div>
          <div style={{
            fontFamily:"'Nunito',sans-serif", fontSize:13,
            color: "var(--text-secondary)", fontWeight:700, marginTop:2,
          }}>Quick-log it here</div>
        </div>
        
        <div style={{marginBottom:16}}>
          <div style={{
            fontSize:10, fontWeight:800, color: "var(--text-secondary)",
            marginBottom:7, letterSpacing:0.5, textTransform:"uppercase",
            fontFamily:"'Nunito',sans-serif",
          }}>Amount</div>
          <div style={{
            display:"flex", alignItems:"center",
            border: `2px solid var(--border-color)`, borderRadius:16,
            background: "var(--bg-input)", overflow:"hidden",
          }}>
            <span style={{
              padding:"0 12px", fontFamily:"'Nunito',sans-serif",
              fontWeight:900, fontSize:20, color:"#c8a0e0",
            }}>‚Çπ</span>
            <input ref={inputRef} type="number" placeholder="0" value={amount}
              onChange={e => setAmount(e.target.value)}
              onKeyDown={e => e.key === "Enter" && category && handleSubmit()}
              style={{
                flex:1, border:"none", outline:"none",
                fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:24,
                color: "var(--text-primary)", background:"transparent",
                padding:"12px 8px",
              }}
            />
          </div>
        </div>
        
        <div style={{marginBottom:16}}>
          <div style={{
            fontSize:10, fontWeight:800, color: "var(--text-secondary)",
            marginBottom:7, letterSpacing:0.5, textTransform:"uppercase",
            fontFamily:"'Nunito',sans-serif",
          }}>Category</div>
          <div style={{display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:8}}>
            {Object.entries(CATS).map(([key, cat]) => (
              <button key={key} onClick={() => setCategory(key)} style={{
                border: `2px solid ${category === key ? cat.dark : cat.color}`,
                background: category === key ? `${cat.color}60` : (isDark ? cat.darkBg : cat.lightBg),
                borderRadius:14, padding:"10px 6px", display:"flex",
                flexDirection:"column", alignItems:"center", gap:4,
                cursor:"pointer", transform: category === key ? "scale(1.05)" : "scale(1)",
                transition:"all 0.2s ease",
                boxShadow: category === key ? `0 4px 16px ${cat.color}70` : "0 2px 8px rgba(0,0,0,0.05)",
              }}>
                <span style={{fontSize:24}}>{cat.emoji}</span>
                <span style={{
                  fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:10,
                  color: category === key ? cat.dark : "var(--text-secondary)",
                }}>{cat.label}</span>
              </button>
            ))}
          </div>
        </div>
        
        <div style={{display:"flex", gap:8}}>
          <button onClick={onSkip} style={{
            flex:1, border: `2px solid var(--border-color)`,
            background: "var(--bg-secondary)", borderRadius:14, padding:"12px",
            fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:14,
            color: "var(--text-tertiary)", cursor:"pointer",
          }}>Skip</button>
          <button onClick={handleSubmit} disabled={!amount || !category} style={{
            flex:1, background: (amount && category)
              ? "linear-gradient(135deg,#FFB6C1,#c8a0e0)"
              : "#e8ddf0",
            border:"none", borderRadius:14, padding:"12px",
            fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:14,
            color: (amount && category) ? "white" : "#c8b8d8",
            cursor: (amount && category) ? "pointer" : "not-allowed",
            boxShadow: (amount && category) ? "0 4px 16px rgba(255,182,193,0.5)" : "none",
          }}>Log It ‚úì</button>
        </div>
      </div>
    </div>
  );
}

function CategorySheet({ amount, spent, budgets, onPick, onCancel, isDark }) {
  const [pressed, setPressed] = useState(null);
  
  return (
    <div style={{
      position:"fixed", inset:0,
      background: isDark ? "rgba(0,0,0,0.7)" : "rgba(70,30,110,0.42)",
      backdropFilter:"blur(10px)", display:"flex", alignItems:"flex-end",
      justifyContent:"center", zIndex:9990, animation:"fadeIn 0.18s ease",
    }}>
      <div style={{
        background: "var(--bg-primary)", borderRadius:"28px 28px 0 0",
        padding:"0 0 40px", width:"100%", maxWidth:480,
        boxShadow: `0 -20px 70px var(--shadow-heavy)`,
        animation:"sheetUp 0.35s cubic-bezier(.25,.8,.25,1)",
      }}>
        <div style={{padding:"14px 0 0", display:"flex", justifyContent:"center"}}>
          <div style={{width:40, height:4, borderRadius:99, background: "var(--border-color)"}}/>
        </div>
        
        <div style={{textAlign:"center", padding:"16px 20px 18px"}}>
          <div style={{
            display:"inline-flex", alignItems:"center", gap:6,
            background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",
            borderRadius:999, padding:"10px 30px",
            boxShadow:"0 6px 20px rgba(255,182,193,0.5)",
          }}>
            <span style={{
              fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:30,
              color:"white", letterSpacing:1,
            }}>‚Çπ{amount}</span>
          </div>
          
          <div style={{
            marginTop:12, fontFamily:"'Nunito',sans-serif", fontWeight:900,
            fontSize:16, color: "var(--text-primary)",
          }}>What was this for? ü§î</div>
          
          <div style={{
            fontFamily:"'Nunito',sans-serif", fontSize:12,
            color: "var(--text-secondary)", fontWeight:700, marginTop:3,
          }}>Tap a bucket below</div>
        </div>
        
        <div style={{
          padding:"0 16px", display:"grid", gridTemplateColumns:"1fr 1fr",
          gap:10, marginBottom:14,
        }}>
          {Object.entries(CATS).map(([key, cat]) => {
            const remaining = budgets[key] - spent[key];
            const afterSpend = remaining - amount;
            const isOver = afterSpend < 0;
            const isClose = !isOver && afterSpend <= 300;
            const isPressed = pressed === key;
            
            return (
              <button key={key}
                onMouseDown={() => setPressed(key)}
                onMouseUp={() => { setPressed(null); onPick(key); }}
                onTouchStart={() => setPressed(key)}
                onTouchEnd={() => { setPressed(null); onPick(key); }}
                onMouseLeave={() => setPressed(null)}
                style={{
                  border: `2.5px solid ${isOver ? "#ff6b6b" : isPressed ? cat.dark : cat.color}`,
                  background: isOver 
                    ? (isDark ? "#3a2530" : "#fff5f5")
                    : isPressed 
                      ? `${cat.color}70` 
                      : (isDark ? cat.darkBg : cat.lightBg),
                  borderRadius:20, padding:"15px 12px", display:"flex",
                  alignItems:"center", gap:11, cursor:"pointer",
                  transform: isPressed ? "scale(0.95)" : "scale(1)",
                  transition:"all 0.15s ease",
                  boxShadow: isPressed
                    ? `0 2px 8px ${cat.color}60`
                    : isOver
                      ? "0 2px 12px rgba(255,100,100,0.2)"
                      : `0 4px 16px ${cat.color}30`,
                  outline:"none", textAlign:"left", width:"100%",
                  WebkitTapHighlightColor:"transparent",
                }}
              >
                <span style={{
                  fontSize:32, flexShrink:0, lineHeight:1,
                  animation: isPressed ? "bounce 0.4s ease" : "none",
                }}>{isOver ? "üò°" : cat.emoji}</span>
                
                <div style={{flex:1, minWidth:0}}>
                  <div style={{
                    fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:14,
                    color: isPressed ? cat.dark : "var(--text-primary)",
                    marginBottom:3,
                  }}>{cat.label}</div>
                  
                  <div style={{
                    fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:11,
                    color: isOver ? "#ff6b6b" : isClose ? "#e8900a" : "var(--text-secondary)",
                  }}>
                    {isOver
                      ? `+‚Çπ${Math.abs(afterSpend)} overspent üò°`
                      : isClose
                        ? `‚ö° ‚Çπ${afterSpend} left`
                        : `‚Çπ${afterSpend} left`
                    }
                  </div>
                  
                  <div style={{
                    marginTop:5, height:4, borderRadius:99,
                    background:"rgba(0,0,0,0.06)", overflow:"hidden",
                  }}>
                    <div style={{
                      height:"100%", borderRadius:99,
                      background: isOver 
                        ? "#ff6b6b"
                        : isClose 
                          ? "#ffb347"
                          : `linear-gradient(90deg,${cat.color},${cat.dark})`,
                      width: `${Math.min(((spent[key] + Number(amount)) / budgets[key]) * 100, 100)}%`,
                    }}/>
                  </div>
                </div>
              </button>
            );
          })}
        </div>
        
        <div style={{padding:"0 16px"}}>
          <button onClick={onCancel} style={{
            width:"100%", border: `2px solid var(--border-color)`,
            background: "var(--bg-secondary)", borderRadius:16, padding:"13px",
            fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:14,
            color: "var(--text-tertiary)", cursor:"pointer",
            WebkitTapHighlightColor:"transparent",
          }}>Cancel ‚úï</button>
        </div>
      </div>
    </div>
  );
}

function Ring({ spent, budget, color, dark, emoji, label, onClick }) {
  const pct = Math.min((spent / budget) * 100, 100);
  const r = 32;
  const circ = 2 * Math.PI * r;
  const dash = circ - (pct / 100) * circ;
  const isOver = spent > budget;
  const overspentAmount = isOver ? spent - budget : 0;
  const isWarn = (budget - spent) <= 300 && !isOver;
  const stroke = isOver ? "#ff6b6b" : isWarn ? "#ffb347" : color;
  
  return (
    <div onClick={onClick} style={{
      display:"flex", flexDirection:"column", alignItems:"center", gap:5,
      cursor: onClick ? "pointer" : "default",
    }}>
      <div style={{position:"relative", width:74, height:74}}>
        {isOver && (
          <div style={{
            position:"absolute", inset:-4, borderRadius:"50%",
            background:"rgba(255,107,107,0.15)",
            animation:"pulse 1.2s ease-in-out infinite",
          }}/>
        )}
        
        <svg width={74} height={74} viewBox="0 0 74 74">
          <circle cx={37} cy={37} r={r} fill="none" stroke="var(--ring-track)" strokeWidth={6.5}/>
          <circle cx={37} cy={37} r={r} fill="none" stroke={stroke} strokeWidth={6.5}
            strokeLinecap="round" strokeDasharray={circ} strokeDashoffset={dash}
            style={{
              transformOrigin:"50% 50%", transform:"rotate(-90deg)",
              transition:"stroke-dashoffset 0.7s cubic-bezier(.4,0,.2,1), stroke 0.4s",
            }}
          />
        </svg>
        
        <div style={{
          position:"absolute", inset:0, display:"flex", alignItems:"center",
          justifyContent:"center", fontSize: isOver ? 20 : 18,
          animation: isOver ? "wobble 0.7s ease-in-out infinite alternate" : "none",
        }}>
          {isOver ? "üò°" : emoji}
        </div>
      </div>
      
      <div style={{textAlign:"center"}}>
        <div style={{
          fontWeight:800, fontSize:10, color: "var(--text-secondary)",
          letterSpacing:0.2, fontFamily:"'Nunito',sans-serif",
        }}>{label}</div>
        
        <div style={{
          fontWeight:700, fontSize:9, fontFamily:"'Nunito',sans-serif",
          color: isOver ? "#ff6b6b" : "var(--text-tertiary)",
        }}>
          {isOver ? `+‚Çπ${overspentAmount}` : `‚Çπ${Math.max(0, budget - spent)} left`}
        </div>
      </div>
    </div>
  );
}

// NEW: Monthly Star Badge
function MonthlyStarBadge({ monthName, currentStar }) {
  const star = currentStar || "black";
  const starColor = star === "pink" ? "var(--star-pink)" : "var(--star-black)";
  
  return (
    <div style={{
      display:"flex", alignItems:"center", gap:8,
      background: star === "pink"
        ? "linear-gradient(135deg, #FFB6C1, #ff9db0)"
        : "linear-gradient(135deg, #4a3455, #2d1a35)",
      border: `2px solid ${starColor}`,
      borderRadius:999, padding:"7px 14px",
    }}>
      <div style={{
        fontSize:20,
        animation: star === "pink" ? "starGlow 2s ease-in-out infinite" : "none",
      }}>‚≠ê</div>
      <div>
        <div style={{
          fontWeight:800, fontSize:10,
          color: star === "pink" ? "white" : "#c8a8d8",
          fontFamily:"'Nunito',sans-serif",
        }}>Current Month</div>
        <div style={{
          fontWeight:700, fontSize:9,
          color: star === "pink" ? "white" : "#a888c0",
          fontFamily:"'Nunito',sans-serif",
        }}>{monthName.split(' ')[0]}</div>
      </div>
    </div>
  );
}

// NEW: Bucket History View
function BucketHistory({ category, transactions, onClose, isDark }) {
  const cat = CATS[category];
  const filtered = transactions.filter(t => t.category === category);
  
  return (
    <div onClick={onClose} style={{
      position:"fixed", inset:0,
      background: isDark ? "rgba(0,0,0,0.7)" : "rgba(70,30,110,0.45)",
      backdropFilter:"blur(10px)", display:"flex", alignItems:"center",
      justifyContent:"center", zIndex:9995, animation:"fadeIn 0.2s ease",
    }}>
      <div onClick={e => e.stopPropagation()} style={{
        background: "var(--bg-card)", borderRadius:28, padding:"28px 24px",
        width:"90%", maxWidth:420, maxHeight:"80vh",
        boxShadow: `0 32px 80px var(--shadow-heavy)`,
        animation:"popIn 0.4s cubic-bezier(.34,1.56,.64,1)",
        display:"flex", flexDirection:"column",
      }}>
        <div style={{marginBottom:20}}>
          <div style={{display:"flex", alignItems:"center", gap:12, marginBottom:4}}>
            <span style={{fontSize:32}}>{cat.emoji}</span>
            <h3 style={{
              fontFamily:"'Nunito',sans-serif", fontSize:20, fontWeight:900,
              color: "var(--text-primary)", flex:1,
            }}>{cat.label} History</h3>
            <button onClick={onClose} style={{
              background:"none", border:"none", fontSize:24,
              color: "var(--text-tertiary)", cursor:"pointer",
            }}>‚úï</button>
          </div>
          <div style={{
            fontFamily:"'Nunito',sans-serif", fontSize:13, fontWeight:700,
            color: "var(--text-secondary)",
          }}>{filtered.length} transaction{filtered.length !== 1 ? 's' : ''}</div>
        </div>
        
        <div style={{flex:1, overflowY:"auto", paddingRight:8}}>
          {filtered.length === 0 ? (
            <div style={{
              textAlign:"center", padding:"40px 20px",
              color: "var(--text-tertiary)",
            }}>
              <div style={{fontSize:40, marginBottom:12}}>{cat.emoji}</div>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14, fontWeight:700,
              }}>No {cat.label.toLowerCase()} transactions yet</div>
            </div>
          ) : (
            [...filtered].reverse().map((t, i) => (
              <div key={i} style={{
                padding:"12px", marginBottom:10,
                background: isDark ? cat.darkBg : cat.lightBg,
                border: `1.5px solid ${cat.color}40`,
                borderRadius:14,
                animation: i === 0 ? "slideRow 0.3s ease" : "none",
              }}>
                <div style={{
                  display:"flex", justifyContent:"space-between",
                  alignItems:"flex-start", marginBottom:t.note ? 6 : 0,
                }}>
                  <div style={{flex:1}}>
                    <div style={{
                      fontFamily:"'Nunito',sans-serif", fontSize:10,
                      fontWeight:700, color: "var(--text-tertiary)",
                    }}>{t.time}</div>
                    {t.note && (
                      <div style={{
                        fontFamily:"'Nunito',sans-serif", fontSize:13,
                        fontWeight:700, color: "var(--text-secondary)",
                        marginTop:4,
                      }}>{t.note}</div>
                    )}
                  </div>
                  <div style={{
                    fontFamily:"'Nunito',sans-serif", fontSize:18,
                    fontWeight:900, color:"#e86090",
                  }}>-‚Çπ{t.amount}</div>
                </div>
              </div>
            ))
          )}
        </div>
      </div>
    </div>
  );
}

// NEW: Yearly Report Screen
function YearlyReport({ yearlyLog, onMonthClick, onClose, isDark }) {
  const sortedMonths = Object.keys(yearlyLog).sort().reverse();
  
  return (
    <div style={{
      position:"fixed", inset:0,
      background: "var(--bg-primary)",
      zIndex:9994,
      overflowY:"auto",
      animation:"fadeIn 0.2s ease",
    }}>
      <div style={{maxWidth:500, margin:"0 auto", padding:"20px"}}>
        <div style={{
          display:"flex", alignItems:"center", justifyContent:"space-between",
          marginBottom:24,
        }}>
          <h2 style={{
            fontFamily:"'Nunito',sans-serif", fontSize:24, fontWeight:900,
            background:"linear-gradient(135deg,#c06080,#9b6dbd)",
            WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent",
          }}>Yearly Report</h2>
          <button onClick={onClose} style={{
            background: "var(--bg-card)", border:"none",
            borderRadius:"50%", width:40, height:40,
            fontSize:20, color: "var(--text-primary)",
            cursor:"pointer", boxShadow: `0 4px 16px var(--shadow)`,
          }}>‚úï</button>
        </div>
        
        {sortedMonths.length === 0 ? (
          <div style={{
            textAlign:"center", padding:"60px 20px",
            background: "var(--bg-card)", borderRadius:24,
            boxShadow: `0 8px 32px var(--shadow)`,
          }}>
            <div style={{fontSize:60, marginBottom:16}}>üìÖ</div>
            <div style={{
              fontFamily:"'Nunito',sans-serif", fontSize:16, fontWeight:800,
              color: "var(--text-primary)", marginBottom:8,
            }}>No completed months yet</div>
            <div style={{
              fontFamily:"'Nunito',sans-serif", fontSize:14, fontWeight:700,
              color: "var(--text-secondary)",
            }}>Keep tracking to build your yearly log!</div>
          </div>
        ) : (
          sortedMonths.map(monthKey => {
            const data = yearlyLog[monthKey];
            return (
              <div key={monthKey}
                onClick={() => onMonthClick(monthKey, data)}
                style={{
                  background: "var(--bg-card)",
                  borderRadius:20, padding:"20px",
                  marginBottom:14,
                  boxShadow: `0 4px 20px var(--shadow)`,
                  cursor:"pointer",
                  transition:"all 0.2s ease",
                  border: `2px solid ${data.star === "pink" ? "var(--star-pink)" : "var(--star-black)"}`,
                }}
              >
                <div style={{
                  display:"flex", alignItems:"center",
                  justifyContent:"space-between",
                }}>
                  <div style={{flex:1}}>
                    <div style={{
                      fontFamily:"'Nunito',sans-serif", fontSize:18,
                      fontWeight:900, color: "var(--text-primary)",
                      marginBottom:4,
                    }}>{data.monthName}</div>
                    <div style={{
                      fontFamily:"'Nunito',sans-serif", fontSize:13,
                      fontWeight:700, color: "var(--text-secondary)",
                    }}>
                      Saved: ‚Çπ{data.saved >= 0 ? data.saved : 0} ¬∑ 
                      Spent: ‚Çπ{data.totalSpent}
                    </div>
                  </div>
                  <div style={{
                    fontSize:40,
                    color: data.star === "pink" ? "var(--star-pink)" : "var(--star-black)",
                    animation: data.star === "pink" ? "starGlow 2s ease-in-out infinite" : "none",
                  }}>‚≠ê</div>
                </div>
              </div>
            );
          })
        )}
      </div>
    </div>
  );
}

// NEW: Month Detail View (from yearly report)
function MonthDetailView({ monthKey, data, onClose, isDark }) {
  if (!data) return null;
  
  return (
    <div style={{
      position:"fixed", inset:0,
      background: "var(--bg-primary)",
      zIndex:9995,
      overflowY:"auto",
      animation:"fadeIn 0.2s ease",
    }}>
      <div style={{maxWidth:500, margin:"0 auto", padding:"20px"}}>
        <div style={{
          display:"flex", alignItems:"center", justifyContent:"space-between",
          marginBottom:24,
        }}>
          <h2 style={{
            fontFamily:"'Nunito',sans-serif", fontSize:22, fontWeight:900,
            color: "var(--text-primary)",
          }}>{data.monthName}</h2>
          <button onClick={onClose} style={{
            background: "var(--bg-card)", border:"none",
            borderRadius:"50%", width:40, height:40,
            fontSize:20, color: "var(--text-primary)",
            cursor:"pointer", boxShadow: `0 4px 16px var(--shadow)`,
          }}>‚úï</button>
        </div>
        
        <div style={{
          background: data.star === "pink"
            ? "linear-gradient(135deg, #FFB6C1, #ff9db0)"
            : "linear-gradient(135deg, #4a3455, #2d1a35)",
          borderRadius:20, padding:"20px", marginBottom:20,
          boxShadow: `0 8px 32px var(--shadow-heavy)`,
        }}>
          <div style={{
            display:"flex", alignItems:"center", gap:16,
            color:"white",
          }}>
            <div style={{
              fontSize:50,
              animation: data.star === "pink" ? "starGlow 2s ease-in-out infinite" : "none",
            }}>‚≠ê</div>
            <div style={{flex:1}}>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:16,
                fontWeight:900, marginBottom:4,
              }}>
                {data.star === "pink" ? "Pink Star Earned!" : "Black Star"}
              </div>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:700, opacity:0.9,
              }}>
                {data.star === "pink" 
                  ? "Stayed within budget üéâ"
                  : "Overspent this month"}
              </div>
            </div>
          </div>
        </div>
        
        <div style={{
          background: "var(--bg-card)", borderRadius:20,
          padding:"20px", marginBottom:20,
          boxShadow: `0 4px 20px var(--shadow)`,
        }}>
          <h3 style={{
            fontFamily:"'Nunito',sans-serif", fontSize:16, fontWeight:900,
            color: "var(--text-primary)", marginBottom:16,
          }}>Summary</h3>
          
          <div style={{display:"grid", gap:12}}>
            <div style={{
              display:"flex", justifyContent:"space-between",
              padding:"12px", background: isDark ? "#3a2445" : "#f9f6ff",
              borderRadius:12,
            }}>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:800, color: "var(--text-secondary)",
              }}>Income:</span>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:900, color: "var(--text-primary)",
              }}>‚Çπ{data.salary}</span>
            </div>
            
            <div style={{
              display:"flex", justifyContent:"space-between",
              padding:"12px", background: isDark ? "#3a2445" : "#f9f6ff",
              borderRadius:12,
            }}>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:800, color: "var(--text-secondary)",
              }}>Total Budget:</span>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:900, color: "var(--text-primary)",
              }}>‚Çπ{data.totalBudget}</span>
            </div>
            
            <div style={{
              display:"flex", justifyContent:"space-between",
              padding:"12px", background: isDark ? "#3a2445" : "#f9f6ff",
              borderRadius:12,
            }}>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:800, color: "var(--text-secondary)",
              }}>Total Spent:</span>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:900, color:"#e86090",
              }}>‚Çπ{data.totalSpent}</span>
            </div>
            
            <div style={{
              display:"flex", justifyContent:"space-between",
              padding:"12px",
              background: data.saved >= 0
                ? "linear-gradient(135deg, #6fd4a8, #40c8a0)"
                : "linear-gradient(135deg, #ff6b6b, #ff8e53)",
              borderRadius:12,
            }}>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:14,
                fontWeight:800, color:"white",
              }}>Saved:</span>
              <span style={{
                fontFamily:"'Nunito',sans-serif", fontSize:16,
                fontWeight:900, color:"white",
              }}>‚Çπ{data.saved >= 0 ? data.saved : 0}</span>
            </div>
          </div>
        </div>
        
        <div style={{
          background: "var(--bg-card)", borderRadius:20,
          padding:"20px",
          boxShadow: `0 4px 20px var(--shadow)`,
        }}>
          <h3 style={{
            fontFamily:"'Nunito',sans-serif", fontSize:16, fontWeight:900,
            color: "var(--text-primary)", marginBottom:16,
          }}>Category Breakdown</h3>
          
          {Object.entries(CATS).map(([key, cat]) => (
            <div key={key} style={{
              display:"flex", alignItems:"center", gap:12,
              padding:"12px", marginBottom:8,
              background: isDark ? cat.darkBg : cat.lightBg,
              border: `1.5px solid ${cat.color}40`,
              borderRadius:12,
            }}>
              <span style={{fontSize:24}}>{cat.emoji}</span>
              <div style={{flex:1}}>
                <div style={{
                  fontFamily:"'Nunito',sans-serif", fontSize:13,
                  fontWeight:800, color: "var(--text-primary)",
                }}>{cat.label}</div>
                <div style={{
                  fontFamily:"'Nunito',sans-serif", fontSize:11,
                  fontWeight:700, color: "var(--text-secondary)",
                }}>‚Çπ{data.spent[key]} / ‚Çπ{data.budgets[key]}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

function SetupScreen({ budgets, onChange, onSave, isDark }) {
  return (
    <div style={{maxWidth:420, margin:"0 auto", padding:"28px 18px"}}>
      <div style={{textAlign:"center", marginBottom:24}}>
        <img src="logo.png" alt="Spendora" style={{width:80, height:80, marginBottom:12}} />
        <h2 style={{
          fontSize:22, fontWeight:900, margin:"8px 0 4px",
          background:"linear-gradient(135deg,#c06080,#9b6dbd)",
          WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent",
          fontFamily:"'Nunito',sans-serif",
        }}>Edit Budgets</h2>
        <p style={{
          color: "var(--text-secondary)", fontSize:13,
          fontFamily:"'Nunito',sans-serif",
        }}>Adjust your monthly limits</p>
      </div>
      
      {Object.entries(CATS).map(([k, cat]) => (
        <div key={k} style={{
          background: "var(--bg-card)", borderRadius:20, padding:"14px 16px",
          marginBottom:10, boxShadow: `0 4px 16px var(--shadow)`,
          border: `2px solid ${cat.color}`, display:"flex",
          alignItems:"center", gap:12,
        }}>
          <span style={{fontSize:26, flexShrink:0}}>{cat.emoji}</span>
          <div style={{flex:1}}>
            <label style={{
              fontWeight:800, color: "var(--text-primary)", fontSize:13,
              display:"block", marginBottom:5, fontFamily:"'Nunito',sans-serif",
            }}>{cat.label}</label>
            <div style={{display:"flex", alignItems:"center", gap:5}}>
              <span style={{fontWeight:900, color:cat.dark, fontSize:16}}>‚Çπ</span>
              <input type="number" value={budgets[k]}
                onChange={e => onChange(k, Number(e.target.value))}
                style={{
                  border: `1.5px solid ${cat.color}`, borderRadius:10,
                  padding:"8px 10px", fontFamily:"'Nunito',sans-serif",
                  fontWeight:800, fontSize:16, width:"100%", outline:"none",
                  color: "var(--text-primary)", background: "var(--bg-input)",
                }}
              />
            </div>
          </div>
        </div>
      ))}
      
      <button onClick={onSave} style={{
        width:"100%", marginTop:10,
        background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",
        color:"white", border:"none", borderRadius:999, padding:"15px",
        fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:17,
        cursor:"pointer", boxShadow:"0 8px 24px rgba(255,182,193,0.5)",
      }}>Save Changes ‚úì</button>
    </div>
  );
}

function History({ txns, isDark }) {
  if (!txns.length) {
    return (
      <div style={{
        textAlign:"center", padding:"28px 16px",
        color: "var(--text-tertiary)", fontFamily:"'Nunito',sans-serif",
      }}>
        <img src="logo.png" alt="" style={{width:60, height:60, marginBottom:8, opacity:0.5}} />
        <div style={{fontWeight:700}}>No transactions yet!</div>
        <div style={{fontSize:12, marginTop:4}}>Log your first spend.</div>
      </div>
    );
  }
  
  return (
    <div style={{maxHeight:300, overflowY:"auto", paddingRight:2}}>
      {[...txns].reverse().map((t, i) => {
        const cat = CATS[t.category];
        return (
          <div key={i} style={{
            display:"flex", alignItems:"center", gap:10, padding:"10px 12px",
            marginBottom:7, background: "var(--bg-secondary)", borderRadius:16,
            boxShadow: `0 2px 10px var(--shadow)`,
            border: `1.5px solid ${cat.color}40`,
            animation: i === 0 ? "slideRow 0.3s ease" : "none",
          }}>
            <div style={{
              width:36, height:36, borderRadius:11, background: `${cat.color}45`,
              display:"flex", alignItems:"center", justifyContent:"center",
              fontSize:18, flexShrink:0,
            }}>{cat.emoji}</div>
            
            <div style={{flex:1}}>
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:13,
                color: "var(--text-primary)",
              }}>{cat.label}</div>
              {t.note && (
                <div style={{
                  fontFamily:"'Nunito',sans-serif", fontSize:11,
                  color: "var(--text-secondary)", fontStyle:"italic",
                }}>{t.note}</div>
              )}
              <div style={{
                fontFamily:"'Nunito',sans-serif", fontSize:10,
                color: "var(--text-tertiary)",
              }}>{t.time}</div>
            </div>
            
            <div style={{
              fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:16,
              color:"#e86090",
            }}>-‚Çπ{t.amount}</div>
          </div>
        );
      })}
    </div>
  );
}

function Blobs() {
  return (
    <div style={{position:"fixed", inset:0, pointerEvents:"none", overflow:"hidden", zIndex:0}}>
      {[
        {s:300, top:-80, left:-80, c:"#FFB6C118", a:"blobA", d:18},
        {s:240, top:"58%", right:-60, c:"#B5D8FF20", a:"blobB", d:22},
        {s:190, bottom:-50, left:"22%", c:"#C1F0DC1a", a:"blobA", d:16},
        {s:170, top:"30%", left:"60%", c:"#E6E6FA22", a:"blobB", d:20},
      ].map((b, i) => (
        <div key={i} style={{
          position:"absolute", width:b.s, height:b.s, borderRadius:"50%",
          background:b.c, top:b.top, left:b.left, right:b.right, bottom:b.bottom,
          animation: `${b.a} ${b.d}s ease-in-out infinite alternate`,
          animationDelay: `${i * 2.8}s`, filter:"blur(44px)",
        }}/>
      ))}
    </div>
  );
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN APP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function Spendora() {
  const [user, setUser] = useState(null);
  const [authLoading, setAuthLoading] = useState(true);
  const [state, setState] = useState(getInitState);
  const [theme, setTheme] = useState(loadTheme);
  const [syncing, setSyncing] = useState(false);
  const [screen, setScreen] = useState("main");
  const [activeTab, setActiveTab] = useState("log");
  const [amount, setAmount] = useState("");
  const [note, setNote] = useState("");
  const [pendingAmt, setPendingAmt] = useState(null);
  const [toast, setToast] = useState({visible:false, message:"", type:"info"});
  const [glutton, setGlutton] = useState(null);
  const [nudge, setNudge] = useState({visible:false, message:""});
  const [confetti, setConfetti] = useState(false);
  const [setupBudgets, setSetupBudgets] = useState(state.budgets);
  const [notifSettings, setNotifSettings] = useState(loadNotifSettings);
  const [showQuickLog, setShowQuickLog] = useState(false);
  const [needsTimezone, setNeedsTimezone] = useState(false);
  const [needsSalarySetup, setNeedsSalarySetup] = useState(false);
  const [bucketHistory, setBucketHistory] = useState(null);
  const [showYearlyReport, setShowYearlyReport] = useState(false);
  const [monthDetail, setMonthDetail] = useState(null);
  const inputRef = useRef(null);
  const saveTimeoutRef = useRef(null);

  useEffect(() => { saveTheme(theme); }, [theme]);

  useEffect(() => {
    if (!isFirebaseConfigured) {
      setAuthLoading(false);
      return;
    }

    const unsubscribe = auth.onAuthStateChanged(async (firebaseUser) => {
      setAuthLoading(false);
      if (firebaseUser) {
        setUser({
          uid: firebaseUser.uid,
          email: firebaseUser.email,
          displayName: firebaseUser.displayName,
          photoURL: firebaseUser.photoURL,
        });
        await loadUserData(firebaseUser.uid);
      } else {
        setUser(null);
        setState(getInitState());
      }
    });

    return () => unsubscribe();
  }, []);

  const loadUserData = async (uid) => {
    setSyncing(true);
    try {
      const doc = await db.collection('users').doc(uid).get();
      if (doc.exists) {
        const data = doc.data();
        setState(data);
        
        // Check if month has ended
        checkMonthEnd(data, setState, showToast);
        
        // Check if needs salary setup
        if (!data.salary || data.salary === 0) {
          setNeedsSalarySetup(true);
        }
      } else {
        const initial = getInitState();
        await db.collection('users').doc(uid).set(initial);
        setState(initial);
        setNeedsSalarySetup(true);
      }
      
      // Check timezone
      if (!loadTimezone()) {
        setNeedsTimezone(true);
      }
    } catch (error) {
      console.error("Error loading data:", error);
      showToast("Failed to load data", "error");
    }
    setSyncing(false);
  };

  useEffect(() => {
    if (user && !syncing && isFirebaseConfigured) {
      if (saveTimeoutRef.current) clearTimeout(saveTimeoutRef.current);
      
      saveTimeoutRef.current = setTimeout(async () => {
        try {
          await db.collection('users').doc(user.uid).set(state);
        } catch (error) {
          console.error("Error saving data:", error);
        }
      }, 1000);
    }

    return () => {
      if (saveTimeoutRef.current) clearTimeout(saveTimeoutRef.current);
    };
  }, [state, user, syncing]);

  // Check month end daily
  useEffect(() => {
    const interval = setInterval(() => {
      checkMonthEnd(state, setState, showToast);
    }, 60000); // Check every minute
    
    return () => clearInterval(interval);
  }, [state]);

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const sharedText = params.get('text');
    if (sharedText) {
      const parsed = parseSMS(sharedText);
      if (parsed) {
        setPendingAmt(parsed);
        showToast(`‚ú® Auto-detected ‚Çπ${parsed} from SMS!`, "success");
      }
      window.history.replaceState({}, '', window.location.pathname);
    }
  }, []);

  useEffect(() => {
    if (notifSettings.enabled && notifSettings.permission === 'granted') {
      scheduleNotifications();
    }
  }, [notifSettings.enabled]);

  useEffect(() => {
    const handler = () => setShowQuickLog(true);
    window.addEventListener('open-quick-log', handler);
    return () => window.removeEventListener('open-quick-log', handler);
  }, []);

  useEffect(() => { saveNotifSettings(notifSettings); }, [notifSettings]);

  const showToast = useCallback((msg, type = "info", dur = 3000) => {
    setToast({visible:true, message:msg, type});
    setTimeout(() => setToast(t => ({...t, visible:false})), dur);
  }, []);

  const enableNotifications = async () => {
    if (!('Notification' in window)) {
      showToast("Notifications not supported üòî", "error");
      return;
    }

    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      setNotifSettings({enabled:true, permission:'granted'});
      showToast("üîî Reminders enabled!", "success");
    } else {
      setNotifSettings({enabled:false, permission:'denied'});
      showToast("Notifications blocked", "error");
    }
  };

  const handleQuickLogSubmit = (amt, cat) => {
    handlePick(cat, amt);
    setShowQuickLog(false);
  };

  const handleAdd = () => {
    const amt = Number(amount);
    if (!amt || amt <= 0) {
      showToast("Enter a valid amount first üôà", "warn");
      inputRef.current?.focus();
      return;
    }
    setPendingAmt(amt);
  };

  const handlePasteSMS = async () => {
    try {
      const text = await navigator.clipboard.readText();
      const parsed = parseSMS(text);
      if (parsed) {
        setPendingAmt(parsed);
        showToast(`‚ú® Found ‚Çπ${parsed} in SMS!`, "success");
      } else {
        showToast("No amount found in clipboard üòï", "warn");
      }
    } catch (err) {
      showToast("Couldn't read clipboard", "error");
    }
  };

  const handlePick = (catKey, customAmount = null) => {
    const amt = customAmount || pendingAmt;
    setPendingAmt(null);
    
    markSpentToday();
    
    const budget = state.budgets[catKey];
    const newSpent = state.spent[catKey] + amt;
    const remaining = budget - newSpent;
    const overspentAmount = newSpent > budget ? newSpent - budget : 0;

    const newState = {
      ...state,
      spent: {...state.spent, [catKey]: newSpent},
      transactions: [
        ...state.transactions,
        {
          category: catKey,
          amount: amt,
          note: note.trim() || null,
          time: new Date().toLocaleString("en-IN", {
            day:"2-digit", month:"short", hour:"2-digit", minute:"2-digit",
          }),
        },
      ],
    };

    // Calculate current star
    newState.currentStar = calculateStar(newState.spent, newState.budgets);

    setState(newState);
    setAmount("");
    setNote("");

    if (newSpent > budget) {
      if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 400]);
      const totalBudget = Object.values(newState.budgets).reduce((a,b) => a+b, 0);
      const totalSpent = Object.values(newState.spent).reduce((a,b) => a+b, 0);
      setTimeout(() => setGlutton({
        category: catKey,
        overspentAmount,
        totalBudget,
        totalSpent,
      }), 150);
    } else if (remaining <= 300) {
      if (navigator.vibrate) navigator.vibrate([150, 100, 150]);
      showToast(`‚ö†Ô∏è Only ‚Çπ${Math.max(0, remaining)} left in ${CATS[catKey].label}!`, "warn");
      if (catKey === "food") {
        setTimeout(() => {
          setNudge({
            visible:true,
            message: NUDGES[Math.floor(Math.random() * NUDGES.length)],
          });
        }, 700);
      }
    } else if (newSpent > budget * 0.5) {
      showToast(`üí° Halfway through ${CATS[catKey].label}!`, "info");
    } else {
      showToast(`‚úÖ ‚Çπ${amt} logged!`, "success");
    }

    const allUnder = Object.keys(CATS).every(k => {
      const s = k === catKey ? newSpent : state.spent[k];
      return s <= newState.budgets[k];
    });
    if (allUnder && Object.values(newState.spent).some(s => s > 0)) {
      setTimeout(() => {
        setConfetti(true);
        setTimeout(() => setConfetti(false), 3200);
      }, 400);
    }
  };

  const handleSignOut = async () => {
    if (!window.confirm("Sign out?")) return;
    try {
      await auth.signOut();
    } catch (error) {
      console.error("Sign out error:", error);
      showToast("Sign out failed", "error");
    }
  };

  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    saveTheme(newTheme);
  };

  const totalSpent = Object.values(state.spent).reduce((a, b) => a + b, 0);
  const totalBudget = Object.values(state.budgets).reduce((a, b) => a + b, 0);
  const overPct = Math.min((totalSpent / totalBudget) * 100, 100);
  const isDark = theme === 'dark';
  const currentStar = state.currentStar || calculateStar(state.spent, state.budgets);

  if (authLoading) {
    return (
      <div style={{
        minHeight:"100dvh",
        background: `linear-gradient(160deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%)`,
        display:"flex", alignItems:"center", justifyContent:"center",
      }}>
        <div style={{textAlign:"center"}}>
          <img src="logo.png" alt="Spendora" style={{
            width:80, height:80, marginBottom:16,
            animation:"pulse 1.5s ease-in-out infinite",
          }} />
          <div style={{
            fontFamily:"'Nunito',sans-serif", fontSize:18, fontWeight:800,
            color: "var(--text-secondary)",
          }}>Loading...</div>
        </div>
      </div>
    );
  }

  if (!user) {
    return <SignInScreen isDark={isDark} />;
  }

  if (needsTimezone) {
    return <TimezoneSetup onComplete={() => setNeedsTimezone(false)} isDark={isDark} />;
  }

  if (needsSalarySetup) {
    return <SalarySetup 
      currentBudgets={state.budgets}
      onComplete={(salary, budgets) => {
        setState(s => ({...s, salary, budgets}));
        setNeedsSalarySetup(false);
      }}
      isDark={isDark}
    />;
  }

  if (screen === "setup") {
    return (
      <div style={{
        minHeight:"100dvh", background: "var(--bg-primary)", position:"relative",
      }}>
        <Blobs />
        <div style={{position:"relative", zIndex:1}}>
          <div style={{padding:"18px 18px 0"}}>
            <button onClick={() => setScreen("main")} style={{
              background: "var(--bg-secondary)", border:"none", borderRadius:999,
              padding:"8px 16px", fontFamily:"'Nunito',sans-serif",
              fontWeight:800, color: "var(--text-primary)", cursor:"pointer",
              boxShadow: `0 2px 12px var(--shadow)`, fontSize:14,
            }}>‚Üê Back</button>
          </div>
          <SetupScreen budgets={setupBudgets}
            onChange={(k, v) => setSetupBudgets(p => ({...p, [k]:v}))}
            onSave={() => {
              setState(p => ({...p, budgets:setupBudgets}));
              setScreen("main");
              showToast("‚ú® Budgets updated!", "success");
            }}
            isDark={isDark}
          />
        </div>
      </div>
    );
  }

  if (showYearlyReport) {
    return <YearlyReport 
      yearlyLog={state.yearlyLog}
      onMonthClick={(monthKey, data) => setMonthDetail({monthKey, data})}
      onClose={() => setShowYearlyReport(false)}
      isDark={isDark}
    />;
  }

  if (monthDetail) {
    return <MonthDetailView 
      monthKey={monthDetail.monthKey}
      data={monthDetail.data}
      onClose={() => setMonthDetail(null)}
      isDark={isDark}
    />;
  }

  return (
    <div style={{minHeight:"100dvh", background: "var(--bg-primary)", position:"relative"}}>
      <Blobs />
      <Confetti active={confetti} />
      <Toast {...toast} />
      <GluttonModal 
        category={glutton?.category} 
        overspentAmount={glutton?.overspentAmount}
        totalBudget={glutton?.totalBudget}
        totalSpent={glutton?.totalSpent}
        onClose={() => setGlutton(null)} 
        isDark={isDark} 
      />
      <Nudge visible={nudge.visible} message={nudge.message} 
        onClose={() => setNudge({visible:false, message:""})} />

      {bucketHistory && (
        <BucketHistory 
          category={bucketHistory}
          transactions={state.transactions}
          onClose={() => setBucketHistory(null)}
          isDark={isDark}
        />
      )}

      <button onClick={toggleTheme} style={{
        position:"fixed", top:20, right:20, zIndex:10001,
        width:48, height:48, borderRadius:"50%",
        background: isDark
          ? "linear-gradient(135deg,#FFB6C1,#ffd700)"
          : "linear-gradient(135deg,#4a4a6a,#2d2d4a)",
        border:"none", cursor:"pointer", display:"flex",
        alignItems:"center", justifyContent:"center", fontSize:24,
        boxShadow: `0 4px 16px var(--shadow)`, transition:"all 0.3s ease",
      }} title={isDark ? 'Light Mode' : 'Dark Mode'}>
        {isDark ? '‚òÄÔ∏è' : 'üåô'}
      </button>

      <NotificationButton 
        enabled={notifSettings.enabled && notifSettings.permission === 'granted'}
        onClick={enableNotifications}
      />

      <div style={{
        position:"fixed", top:20, left:20, zIndex:10001,
        display:"flex", alignItems:"center", gap:12,
        background: "var(--bg-card)", padding:"8px 16px 8px 8px",
        borderRadius:999, boxShadow: `0 4px 16px var(--shadow)`,
      }}>
        <img src={user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}&background=FFB6C1&color=fff`}
          alt="Profile" style={{
            width:36, height:36, borderRadius:"50%",
            border:"2px solid #FFB6C1",
          }}
        />
        <div>
          <div style={{
            fontFamily:"'Nunito',sans-serif", fontSize:13, fontWeight:900,
            color: "var(--text-primary)",
          }}>
            {user.displayName?.split(' ')[0] || 'User'}
          </div>
          <button onClick={handleSignOut} style={{
            fontFamily:"'Nunito',sans-serif", fontSize:10, fontWeight:700,
            color: "var(--text-tertiary)", background:"none", border:"none",
            cursor:"pointer", padding:0,
          }}>Sign Out</button>
        </div>
      </div>

      {syncing && (
        <div style={{
          position:"fixed", bottom:20, right:20, zIndex:10001,
          background: "var(--bg-card)", padding:"8px 16px", borderRadius:999,
          boxShadow: `0 4px 16px var(--shadow)`,
          fontFamily:"'Nunito',sans-serif", fontSize:12, fontWeight:700,
          color: "var(--text-secondary)", display:"flex",
          alignItems:"center", gap:8,
        }}>
          <div style={{
            width:12, height:12, border: `2px solid var(--text-tertiary)`,
            borderTopColor:"#FFB6C1", borderRadius:"50%",
            animation:"spin 0.8s linear infinite",
          }}/>
          Syncing...
        </div>
      )}

      {showQuickLog && (
        <QuickLogModal onLog={handleQuickLogSubmit}
          onSkip={() => setShowQuickLog(false)} isDark={isDark} />
      )}

      {pendingAmt !== null && (
        <CategorySheet amount={pendingAmt} spent={state.spent}
          budgets={state.budgets} onPick={handlePick}
          onCancel={() => setPendingAmt(null)} isDark={isDark} />
      )}

      <div style={{
        maxWidth:480, margin:"0 auto", position:"relative",
        zIndex:1, paddingBottom:32, paddingTop:80,
      }}>
        <div style={{
          background: `linear-gradient(160deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%)`,
          padding:"26px 18px 18px", borderRadius:"0 0 30px 30px",
          boxShadow: `0 8px 30px var(--shadow)`, position:"relative",
          overflow:"hidden",
        }}>
          <div style={{
            display:"flex", justifyContent:"space-between",
            alignItems:"flex-start",
          }}>
            <div>
              <div style={{
                fontSize:10, fontWeight:800, color: "var(--text-tertiary)",
                letterSpacing:2, textTransform:"uppercase",
                fontFamily:"'Nunito',sans-serif",
              }}>Spendora</div>

              <h1 style={{
                margin:"4px 0 2px", fontSize:20, fontWeight:900,
                background:"linear-gradient(135deg,#c06080,#9b6dbd)",
                WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent",
                fontFamily:"'Nunito',sans-serif",
              }}>Hi, {user.displayName?.split(' ')[0] || 'Friend'}! üëã</h1>

              <div style={{
                fontSize:11, color: "var(--text-secondary)",
                fontWeight:700, fontFamily:"'Nunito',sans-serif",
              }}>{state.monthName}</div>
            </div>

            <MonthlyStarBadge monthName={state.monthName} currentStar={currentStar} />
          </div>

          <div style={{marginTop:16}}>
            <div style={{
              display:"flex", justifyContent:"space-between", marginBottom:5,
            }}>
              <span style={{
                fontSize:11, fontWeight:800, color: "var(--text-primary)",
                fontFamily:"'Nunito',sans-serif",
              }}>‚Çπ{totalSpent} / ‚Çπ{totalBudget}</span>

              <span style={{
                fontSize:11, fontWeight:700, color: "var(--text-secondary)",
                fontFamily:"'Nunito',sans-serif)",
              }}>{overPct.toFixed(0)}% used</span>
            </div>

            <div style={{
              background: isDark ? "#3a2a45" : "white",
              borderRadius:999, height:9, overflow:"hidden",
              boxShadow: `inset 0 2px 6px var(--shadow)`,
            }}>
              <div style={{
                height:"100%", borderRadius:999,
                background: overPct >= 90
                  ? "linear-gradient(90deg,#ff6b6b,#ff8e53)"
                  : overPct >= 60
                    ? "linear-gradient(90deg,#ffb347,#ffd700)"
                    : "linear-gradient(90deg,#FFB6C1,#c8a0e0)",
                width: `${overPct}%`,
                transition:"width 0.7s cubic-bezier(.4,0,.2,1)",
              }}/>
            </div>
          </div>
        </div>

        <div style={{padding:"20px 18px 0"}}>
          <div style={{
            display:"grid", gridTemplateColumns:"repeat(5,1fr)", gap:6,
          }}>
            {Object.entries(CATS).map(([k, cat]) => (
              <Ring key={k} spent={state.spent[k]} budget={state.budgets[k]}
                color={cat.color} dark={cat.dark} emoji={cat.emoji}
                label={cat.label} onClick={() => setBucketHistory(k)} />
            ))}
          </div>
        </div>

        <div style={{padding:"16px 18px 0", display:"flex", gap:8}}>
          {["log", "history"].map(tab => (
            <button key={tab} onClick={() => setActiveTab(tab)} style={{
              flex:1, border:"none", borderRadius:14, padding:"10px 0",
              fontFamily:"'Nunito',sans-serif", fontWeight:800, fontSize:13,
              cursor:"pointer",
              background: activeTab === tab
                ? "linear-gradient(135deg,#FFB6C1,#c8a0e0)"
                : "var(--bg-secondary)",
              color: activeTab === tab ? "white" : "var(--text-secondary)",
              boxShadow: activeTab === tab
                ? "0 4px 16px rgba(255,182,193,0.4)"
                : `0 2px 10px var(--shadow)`,
              transition:"all 0.25s ease",
              WebkitTapHighlightColor:"transparent",
            }}>
              {tab === "log" ? "üí∏ Log Spend" : `üìã ${state.monthName.split(' ')[0]} History`}
            </button>
          ))}
        </div>

        {activeTab === "log" && (
          <div style={{padding:"14px 18px"}}>
            <div style={{
              background: "var(--bg-card)", borderRadius:22, padding:"20px",
              marginBottom:12, boxShadow: `0 4px 24px var(--shadow)`,
            }}>
              <button onClick={handlePasteSMS} style={{
                width:"100%", marginBottom:16,
                background: isDark
                  ? "linear-gradient(135deg,#3a2445,#2d1a35)"
                  : "linear-gradient(135deg,#f0e4ff,#ffe8f5)",
                border: `2px dashed ${isDark ? "#6050a0" : "#d8b8f0"}`,
                borderRadius:16, padding:"14px",
                fontFamily:"'Nunito',sans-serif", fontWeight:900, fontSize:14,
                color: "var(--text-primary)", cursor:"pointer",
                display:"flex", alignItems:"center", justifyContent:"center",
                gap:8, transition:"all 0.2s ease",
              }}>
                <span style={{fontSize:20}}>üìã</span>
                Paste SMS to Auto-Fill Amount
              </button>

              <div style={{
                background: isDark
                  ? "linear-gradient(135deg,#3a2445,#2d1a35)"
                  : "linear-gradient(135deg,#fff0f8,#f0eaff)",
                borderRadius:14, padding:"10px 14px", marginBottom:16,
                border: `1.5px dashed var(--border-color)`,
                fontFamily:"'Nunito',sans-serif", fontSize:12, fontWeight:700,
                color: "var(--text-secondary)", display:"flex",
                alignItems:"center", gap:8,
              }}>
                <span style={{fontSize:18}}>üí°</span>
                Copy SMS ‚Üí Tap Paste ‚Üí Pick bucket!
              </div>

              <div style={{marginBottom:14}}>
                <div style={{
                  fontSize:10, fontWeight:800, color: "var(--text-secondary)",
                  marginBottom:7, letterSpacing:0.5, textTransform:"uppercase",
                  fontFamily:"'Nunito',sans-serif",
                }}>Or enter manually</div>

                <div style={{display:"flex", gap:8, alignItems:"stretch"}}>
                  <div style={{
                    display:"flex", alignItems:"center", flex:1,
                    border: `2px solid var(--border-color)`, borderRadius:16,
                    background: "var(--bg-input)", overflow:"hidden",
                  }}>
                    <span style={{
                      padding:"0 12px", fontFamily:"'Nunito',sans-serif",
                      fontWeight:900, fontSize:22, color:"#c8a0e0",
                    }}>‚Çπ</span>

                    <input ref={inputRef} type="number" placeholder="0"
                      value={amount} onChange={e => setAmount(e.target.value)}
                      onKeyDown={e => e.key === "Enter" && handleAdd()}
                      style={{
                        flex:1, border:"none", outline:"none",
                        fontFamily:"'Nunito',sans-serif", fontWeight:900,
                        fontSize:28, color: "var(--text-primary)",
                        background:"transparent", padding:"14px 8px",
                        width:"100%",
                      }}
                    />
                  </div>

                  <button onClick={handleAdd} style={{
                    background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",
                    border:"none", borderRadius:16, padding:"0 22px",
                    fontFamily:"'Nunito',sans-serif", fontWeight:900,
                    fontSize:16, color:"white", cursor:"pointer",
                    boxShadow:"0 4px 16px rgba(255,182,193,0.5)",
                    whiteSpace:"nowrap",
                    WebkitTapHighlightColor:"transparent",
                  }}>Add ‚ûï</button>
                </div>
              </div>

              <div>
                <div style={{
                  fontSize:10, fontWeight:800, color: "var(--text-secondary)",
                  marginBottom:6, letterSpacing:0.5, textTransform:"uppercase",
                  fontFamily:"'Nunito',sans-serif",
                }}>Note (optional)</div>

                <input type="text" placeholder="e.g. Lunch, Uber..."
                  value={note} onChange={e => setNote(e.target.value)}
                  maxLength={60} style={{
                    width:"100%", border: `1.5px solid var(--border-color)`,
                    borderRadius:12, padding:"10px 14px",
                    fontFamily:"'Nunito',sans-serif", fontWeight:700,
                    fontSize:13, color: "var(--text-primary)",
                    background: "var(--bg-input)", outline:"none",
                  }}
                />
              </div>
            </div>
          </div>
        )}

        {activeTab === "history" && (
          <div style={{padding:"14px 18px"}}>
            <div style={{
              background: "var(--bg-card)", borderRadius:22, padding:"18px",
              boxShadow: `0 4px 24px var(--shadow)`,
            }}>
              <History txns={state.transactions} isDark={isDark} />
            </div>
          </div>
        )}

        <div style={{padding:"0 18px", display:"flex", gap:8}}>
          <button onClick={() => {
            setSetupBudgets(state.budgets);
            setScreen("setup");
          }} style={{
            flex:1, border: `2px solid ${CATS.education.color}`,
            background: "var(--bg-secondary)", borderRadius:14,
            padding:"12px", fontFamily:"'Nunito',sans-serif",
            fontWeight:800, fontSize:12, color: "var(--text-primary)",
            cursor:"pointer",
          }}>‚öôÔ∏è Edit Budgets</button>

          <button onClick={() => setShowYearlyReport(true)} style={{
            flex:1, border: `2px solid ${CATS.hobbies.color}`,
            background: "var(--bg-secondary)", borderRadius:14,
            padding:"12px", fontFamily:"'Nunito',sans-serif",
            fontWeight:800, fontSize:12, color: "var(--text-primary)",
            cursor:"pointer",
          }}>üìä Yearly Report</button>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<Spendora/>);

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').catch(() => {});
  });
}
</script>
</body>
</html>
